box: markadams/chromium-xvfb-js
build:
  steps:
    - npm-install
    - script:
        name: node dependencies
        code: |
          npm install -g bower
    - script:
        name: bower install
        code: |
          bower install --allow-root --config.interactive=false
    - script:
        name: gulp install
        code: |
          npm install -g gulp-cli && gulp
    - script:
        name: npm test
        code: |
          xvfb-run npm test
deploy:
  steps:
    - script:
        name: install bower
        code: npm install -g bower
    - script:
        name: clone posts
        code: |
          cd build/unbundled && git clone https://github.com/H-Plus-Time/blog.git && \
          rm -r blog/.git && cp blog/bower.json ./ && bower install --allow-root && cd ../../
    - script:
        name: install surge
        code: |
          npm install -g surge
    - script:
        name: push to surge domain
        code: surge build/unbundled hplustime.com --token $SURGE_TOKEN
