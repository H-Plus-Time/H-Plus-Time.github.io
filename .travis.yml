language: node_js
sudo: required
dist: trusty
addons:
  apt:
    sources:
      - google-chrome
    packages:
      - google-chrome-stable
      - git
node_js:
  - '7'
before_script:
  - npm install -g bower polymer-cli lighthouse surge
  - bower install
  - polymer build
  - |
    cd build/default && git clone https://github.com/H-Plus-Time/blog.git
    rm -r blog/.git && cp blog/bower.json ./ && bower install --force --allow-root && cd ../../
  - surge build/default hplustime.com --token $SURGE_TOKEN
script:
  - mkdir report && cp README.md report
  - lighthouse --chrome-flags="--disable-gpu --headless" https://hplustime.com --output json --output-path=report/lighthouse_results.json
  - lighthouse --chrome-flags="--disable-gpu --headless" https://hplustime.com --output html --output-path=report/index.html
  - echo audit.hplustime.com > report/CNAME
  - surge report audit.hplustime.com --token $SURGE_TOKEN